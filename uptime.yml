---
- name: Check uptime and determine root inventory
  hosts: all
  gather_facts: no  # KhÃ´ng cáº§n facts Ä‘á»ƒ trÃ¡nh lá»—i ansible_os_family

  vars:
    telegram_bot_token: "6725419910:AAFPnpMWsIU_kuGFw_RkdjQeyvhzZQ1qxPA"
    telegram_chat_id: "-4132281180"

  tasks:
    - name: XÃ¡c Ä‘á»‹nh inventory gá»‘c chÃ­nh xÃ¡c
      set_fact:
        root_inventory: >-
          {{
            groups.keys()
            | difference(['all', 'ungrouped', 'all-linux', 'all-win'])
            | select('in', group_names)
            | list
            | first
            | default('unknown')
          }}

    - name: Láº¥y uptime trÃªn Linux
      command: uptime
      register: uptime_result
      ignore_errors: yes  # TrÃ¡nh lá»—i khi khÃ´ng láº¥y Ä‘Æ°á»£c uptime

    - name: Hiá»ƒn thá»‹ thÃ´ng tin
      debug:
        msg: >-
          ğŸ–¥ Host: {{ inventory_hostname }} ({{ ansible_host }})
          ğŸ· Inventory gá»‘c: {{ root_inventory }}
          â³ Uptime: {{ uptime_result.stdout | default('KhÃ´ng láº¥y Ä‘Æ°á»£c') }}

        - name: Gá»­i thÃ´ng bÃ¡o Telegram
      uri:
        url: "https://api.telegram.org/bot{{ telegram_bot_token }}/sendMessage"
        method: POST
        body_format: json
        body:
          chat_id: "{{ telegram_chat_id }}"
          text: >-
            ğŸ–¥ Host: {{ inventory_hostname }} ({{ ansible_host }})
            ğŸ“‚ Inventory gá»‘c: {{ root_inventory }}
            
            â³ Uptime:
            {{ uptime_result.stdout | default('KhÃ´ng láº¥y Ä‘Æ°á»£c') }}
        headers:
          Content-Type: "application/json"
