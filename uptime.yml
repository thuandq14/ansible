---
- name: Ki·ªÉm tra uptime v√† g·ª≠i Telegram
  hosts: all-linux
  gather_facts: yes
  tasks:
    - name: L·∫•y th√¥ng tin uptime (Linux)
      command: uptime -p
      register: uptime_result
      when: ansible_os_family == "RedHat" or ansible_os_family == "Debian"

    - name: L·∫•y th√¥ng tin uptime (Windows)
      win_shell: "Get-CimInstance Win32_OperatingSystem | Select-Object LastBootUpTime"
      register: uptime_result
      when: ansible_os_family == "Windows"

    - name: X√°c ƒë·ªãnh Inventory g·ªëc
      set_fact:
        inventory_root: "{{ groups.keys() 
          | select('match', '^(?!all|ungrouped|linux|win|all-linux|all-win).*') 
          | select('search', inventory_hostname) 
          | list | first | default('Unknown') }}"
    
    - name: G·ª≠i th√¥ng b√°o qua Telegram
      uri:
        url: "https://api.telegram.org/bot<BOT_TOKEN>/sendMessage"
        method: POST
        body_format: json
        body:
          chat_id: "-4132281180"
          text: "üü¢ Host {{ inventory_hostname }} (Inventory: {{ inventory_root }}) uptime: {{ uptime_result.stdout | default('_
